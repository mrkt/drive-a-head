# ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²è¯´æ˜ - v2.0

**éƒ¨ç½²æ—¥æœŸ**: 2025-12-01
**ç‰ˆæœ¬**: v2.0
**åŒ…å«åŠŸèƒ½**:
- âœ… 8ç§è½¦è¾†ç±»å‹
- âœ… æ™ºèƒ½æœåŠ¡å™¨åœ°å€æ£€æµ‹ï¼ˆè‡ªåŠ¨åŒºåˆ†æœ¬åœ°/ç”Ÿäº§ç¯å¢ƒï¼‰
- âœ… ç§»åŠ¨ç«¯è™šæ‹Ÿæ‘‡æ†
- âœ… ç§»åŠ¨ç«¯æ—¥å¿—æ˜¾ç¤ºå·¥å…·ï¼ˆé»˜è®¤éšè—ï¼‰
- âœ… iPhone/Androidæ‰‹æœºç«¯å®Œå…¨æ”¯æŒ

---

## ğŸ“¦ éƒ¨ç½²åŒ…å†…å®¹

### 1. WebGLå®¢æˆ·ç«¯
**ä½ç½®**: `deployment/Builds/WebGL/`
**å¤§å°**: çº¦ 11MB

**å…³é”®æ–‡ä»¶**:
- `index.html` - æ¸¸æˆå…¥å£é¡µé¢ï¼ˆå·²é›†æˆè™šæ‹Ÿæ‘‡æ†ï¼‰
- `virtual-joystick.js` - è™šæ‹Ÿæ‘‡æ†è„šæœ¬
- `virtual-joystick.css` - è™šæ‹Ÿæ‘‡æ†æ ·å¼
- `Build/WebGL.data.gz` - æ¸¸æˆæ•°æ® (4.1MB)
- `Build/WebGL.wasm.gz` - WebAssemblyæ ¸å¿ƒ (7.1MB)
- `Build/WebGL.framework.js.gz` - Unityæ¡†æ¶ (78KB)
- `Build/WebGL.loader.js` - åŠ è½½å™¨

### 2. LinuxæœåŠ¡å™¨
**ä½ç½®**: `deployment/server/`
**å¤§å°**: 7.0MB

**æ–‡ä»¶**:
- `server-linux` - Linux x64å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆå·²è®¾ç½®æ‰§è¡Œæƒé™ï¼‰

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ–¹æ¡ˆAï¼šä½¿ç”¨SCPä¸Šä¼ ï¼ˆæ¨èï¼‰

```bash
# 1. ä¸Šä¼ æ•´ä¸ªdeploymentç›®å½•åˆ°æœåŠ¡å™¨
scp -r /Users/admin/unity_project/car/deployment root@YOUR_SERVER:/opt/car-game/

# 2. SSHç™»å½•æœåŠ¡å™¨
ssh root@YOUR_SERVER

# 3. è¿›å…¥æœåŠ¡å™¨ç›®å½•
cd /opt/car-game/deployment/server

# 4. å¯åŠ¨æœåŠ¡å™¨
./server-linux

# 5. é…ç½®Nginxï¼ˆå¦‚æœéœ€è¦ï¼‰
# å‚è€ƒä¸‹é¢çš„Nginxé…ç½®ç« èŠ‚
```

### æ–¹æ¡ˆBï¼šä½¿ç”¨rsyncåŒæ­¥ï¼ˆå¢é‡æ›´æ–°ï¼‰

```bash
# åŒæ­¥åˆ°æœåŠ¡å™¨ï¼ˆåªä¼ è¾“å˜åŒ–çš„æ–‡ä»¶ï¼‰
rsync -avz --progress /Users/admin/unity_project/car/deployment/ root@YOUR_SERVER:/opt/car-game/deployment/
```

---

## ğŸŒ Nginxé…ç½®ç¤ºä¾‹

### 1. é™æ€æ–‡ä»¶æœåŠ¡ï¼ˆWebGLï¼‰

```nginx
server {
    listen 80;
    server_name yourdomain.com;

    # WebGLæ¸¸æˆæ–‡ä»¶
    location / {
        root /opt/car-game/deployment/Builds/WebGL;
        index index.html;

        # å¯ç”¨gzip
        gzip on;
        gzip_types application/javascript application/wasm text/css;

        # ç¼“å­˜ç­–ç•¥
        location ~* \.(js|css|wasm|data)$ {
            expires 7d;
            add_header Cache-Control "public, immutable";
        }
    }

    # WebSocketä»£ç†ï¼ˆæ¸¸æˆæœåŠ¡å™¨ï¼‰
    location /ws {
        proxy_pass http://localhost:8899;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

        # WebSocketè¶…æ—¶è®¾ç½®
        proxy_read_timeout 3600s;
        proxy_send_timeout 3600s;
    }
}
```

### 2. HTTPSé…ç½®ï¼ˆæ¨èï¼‰

```nginx
server {
    listen 443 ssl http2;
    server_name yourdomain.com;

    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    # WebGLæ¸¸æˆæ–‡ä»¶
    location / {
        root /opt/car-game/deployment/Builds/WebGL;
        index index.html;
        gzip on;
    }

    # WebSocketä»£ç†ï¼ˆä½¿ç”¨wss://ï¼‰
    location /ws {
        proxy_pass http://localhost:8899;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

        proxy_read_timeout 3600s;
        proxy_send_timeout 3600s;
    }
}

# HTTPé‡å®šå‘åˆ°HTTPS
server {
    listen 80;
    server_name yourdomain.com;
    return 301 https://$server_name$request_uri;
}
```

---

## ğŸ”§ æœåŠ¡å™¨å¯åŠ¨ç®¡ç†

### ä½¿ç”¨systemdç®¡ç†æœåŠ¡ï¼ˆæ¨èï¼‰

åˆ›å»ºæœåŠ¡æ–‡ä»¶: `/etc/systemd/system/car-game.service`

```ini
[Unit]
Description=Car Game Server
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/opt/car-game/deployment/server
ExecStart=/opt/car-game/deployment/server/server-linux
Restart=always
RestartSec=10

# æ—¥å¿—
StandardOutput=append:/var/log/car-game/server.log
StandardError=append:/var/log/car-game/error.log

[Install]
WantedBy=multi-user.target
```

**ç®¡ç†å‘½ä»¤**:
```bash
# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p /var/log/car-game

# é‡è½½systemdé…ç½®
systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
systemctl start car-game

# è®¾ç½®å¼€æœºè‡ªå¯
systemctl enable car-game

# æŸ¥çœ‹çŠ¶æ€
systemctl status car-game

# æŸ¥çœ‹æ—¥å¿—
journalctl -u car-game -f

# åœæ­¢æœåŠ¡
systemctl stop car-game

# é‡å¯æœåŠ¡
systemctl restart car-game
```

### ä½¿ç”¨nohupåå°è¿è¡Œï¼ˆç®€å•æ–¹å¼ï¼‰

```bash
cd /opt/car-game/deployment/server
nohup ./server-linux > server.log 2>&1 &

# æŸ¥çœ‹æ—¥å¿—
tail -f server.log

# åœæ­¢æœåŠ¡
pkill -f server-linux
```

---

## âœ… éƒ¨ç½²éªŒè¯

### 1. æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦è¿è¡Œ

```bash
# æ£€æŸ¥è¿›ç¨‹
ps aux | grep server-linux

# æ£€æŸ¥ç«¯å£
netstat -tlnp | grep 8899
# æˆ–
ss -tlnp | grep 8899
```

### 2. æµ‹è¯•WebSocketè¿æ¥

```bash
# ä½¿ç”¨wscatæµ‹è¯•ï¼ˆéœ€è¦å…ˆå®‰è£…: npm install -g wscatï¼‰
wscat -c ws://localhost:8899/ws
```

### 3. æµè§ˆå™¨æµ‹è¯•

**ç”µè„‘ç«¯**:
- è®¿é—®: `http://yourdomain.com`
- åº”è¯¥èƒ½çœ‹åˆ°æ¸¸æˆåŠ è½½
- åº”è¯¥èƒ½ç”Ÿæˆè½¦è¾†å¹¶æ¸¸ç©

**æ‰‹æœºç«¯**:
- è®¿é—®: `http://yourdomain.com`
- åº”è¯¥èƒ½çœ‹åˆ°æ¸¸æˆåŠ è½½
- åº”è¯¥èƒ½çœ‹åˆ°è™šæ‹Ÿæ‘‡æ†ï¼ˆå±å¹•å·¦ä¸‹è§’ï¼‰
- åº”è¯¥èƒ½ç”Ÿæˆè½¦è¾†å¹¶ä½¿ç”¨æ‘‡æ†æ§åˆ¶

### 4. æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
tail -f /var/log/car-game/server.log

# æˆ–è€…å¦‚æœä½¿ç”¨nohup
tail -f /opt/car-game/deployment/server/server.log

# æŸ¥çœ‹ç©å®¶è¿æ¥
grep "Player joined" server.log

# æŸ¥çœ‹é”™è¯¯
grep "ERROR\|error" server.log
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜1: æœåŠ¡å™¨æ— æ³•å¯åŠ¨

**æ£€æŸ¥**:
```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -l /opt/car-game/deployment/server/server-linux

# å¦‚æœæ²¡æœ‰æ‰§è¡Œæƒé™ï¼Œæ·»åŠ 
chmod +x /opt/car-game/deployment/server/server-linux

# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -tlnp | grep 8899
```

### é—®é¢˜2: æ‰‹æœºç«¯æ— æ³•è¿æ¥

**æ£€æŸ¥**:
1. ç¡®è®¤æœåŠ¡å™¨é˜²ç«å¢™å¼€æ”¾äº†8899ç«¯å£
2. ç¡®è®¤Nginxé…ç½®æ­£ç¡®
3. æ£€æŸ¥WebSocketä»£ç†æ˜¯å¦æ­£å¸¸å·¥ä½œ
4. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯

### é—®é¢˜3: è™šæ‹Ÿæ‘‡æ†ä¸æ˜¾ç¤º

**æ£€æŸ¥**:
1. ç¡®è®¤ `virtual-joystick.js` å’Œ `virtual-joystick.css` æ–‡ä»¶å­˜åœ¨
2. ç¡®è®¤ `index.html` ä¸­åŒ…å«è™šæ‹Ÿæ‘‡æ†å¼•ç”¨
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰åŠ è½½é”™è¯¯

```bash
# éªŒè¯æ–‡ä»¶å­˜åœ¨
ls -la /opt/car-game/deployment/Builds/WebGL/virtual-joystick.*

# éªŒè¯index.htmlä¸­çš„å¼•ç”¨
grep "virtual-joystick" /opt/car-game/deployment/Builds/WebGL/index.html
```

---

## ğŸ“Š æ€§èƒ½ç›‘æ§

### æœåŠ¡å™¨èµ„æºç›‘æ§

```bash
# CPUå’Œå†…å­˜ä½¿ç”¨
top -p $(pgrep server-linux)

# æˆ–ä½¿ç”¨htop
htop -p $(pgrep server-linux)

# ç½‘ç»œè¿æ¥æ•°
netstat -an | grep 8899 | wc -l
```

### æ—¥å¿—åˆ†æ

```bash
# ç»Ÿè®¡åœ¨çº¿ç©å®¶æ•°
grep "Player joined" server.log | tail -100 | wc -l

# æŸ¥çœ‹æœ€è¿‘çš„ç©å®¶æ´»åŠ¨
tail -50 server.log | grep "Player"

# ç»Ÿè®¡é”™è¯¯æ•°é‡
grep -c "ERROR" server.log
```

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²

å½“æœ‰æ–°ç‰ˆæœ¬æ—¶ï¼š

```bash
# 1. åœæ­¢æœåŠ¡
systemctl stop car-game

# 2. å¤‡ä»½å½“å‰ç‰ˆæœ¬
cp -r /opt/car-game/deployment /opt/car-game/deployment.backup.$(date +%Y%m%d_%H%M%S)

# 3. ä¸Šä¼ æ–°ç‰ˆæœ¬
scp -r /path/to/new/deployment root@YOUR_SERVER:/opt/car-game/

# 4. å¯åŠ¨æœåŠ¡
systemctl start car-game

# 5. éªŒè¯
systemctl status car-game
tail -f /var/log/car-game/server.log
```

---

## ğŸ“ é‡è¦æ³¨æ„äº‹é¡¹

### 1. æ™ºèƒ½æœåŠ¡å™¨åœ°å€æ£€æµ‹

å®¢æˆ·ç«¯ä¼šè‡ªåŠ¨æ£€æµ‹ç¯å¢ƒï¼š
- **æœ¬åœ°æµ‹è¯•** (192.168.*/localhost): è¿æ¥ `ws://192.168.1.9:8899/ws`
- **ç”Ÿäº§ç¯å¢ƒ**: è‡ªåŠ¨ä½¿ç”¨å½“å‰åŸŸåæ„å»ºWebSocketåœ°å€
  - HTTP: `ws://yourdomain.com:8899/ws`
  - HTTPS: `wss://yourdomain.com:8899/ws`

**æ— éœ€ä¿®æ”¹ä»»ä½•ä»£ç ï¼**

### 2. é˜²ç«å¢™é…ç½®

ç¡®ä¿å¼€æ”¾ä»¥ä¸‹ç«¯å£ï¼š
- **80** (HTTP)
- **443** (HTTPSï¼Œå¦‚æœä½¿ç”¨)
- **8899** (WebSocketæ¸¸æˆæœåŠ¡å™¨)

```bash
# Ubuntu/Debian (ufw)
ufw allow 80/tcp
ufw allow 443/tcp
ufw allow 8899/tcp

# CentOS/RHEL (firewalld)
firewall-cmd --permanent --add-port=80/tcp
firewall-cmd --permanent --add-port=443/tcp
firewall-cmd --permanent --add-port=8899/tcp
firewall-cmd --reload
```

### 3. ç§»åŠ¨ç«¯æ—¥å¿—å·¥å…·

æ¸¸æˆå†…ç½®äº†ç§»åŠ¨ç«¯æ—¥å¿—æ˜¾ç¤ºå·¥å…·ï¼š
- é»˜è®¤éšè—ï¼Œä¸å½±å“æ¸¸æˆä½“éªŒ
- ç‚¹å‡»å³ä¸Šè§’"Show Log"æŒ‰é’®å¯ä»¥æ˜¾ç¤º/éšè—
- æ–¹ä¾¿è°ƒè¯•å’Œé—®é¢˜æ’æŸ¥

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. æœåŠ¡å™¨æ—¥å¿—ï¼ˆæœ€è¿‘100è¡Œï¼‰
2. æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
3. æœåŠ¡å™¨ç³»ç»Ÿä¿¡æ¯ï¼ˆOSç‰ˆæœ¬ã€å†…å­˜ã€CPUï¼‰
4. é—®é¢˜å¤ç°æ­¥éª¤

---

**éƒ¨ç½²å®Œæˆåï¼Œè¯·è®¿é—®æ¸¸æˆå¹¶æµ‹è¯•æ‰€æœ‰åŠŸèƒ½ï¼** âœ¨
