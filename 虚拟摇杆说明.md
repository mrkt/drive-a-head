# 🎮 虚拟摇杆使用说明

## ✅ 已完成

虚拟摇杆已经添加到部署包中，**无需重新构建 WebGL**！

---

## 📦 包含的文件

```
deployment/Builds/WebGL/
├── index.html              # 已修改，引用虚拟摇杆文件
├── virtual-joystick.css    # 虚拟摇杆样式（独立文件）
├── virtual-joystick.js     # 虚拟摇杆逻辑（独立文件）
├── Build/                  # Unity WebGL 构建文件
└── TemplateData/           # Unity 模板资源
```

---

## 🔄 更新到服务器

### 方式1：只更新虚拟摇杆相关文件（推荐）

```bash
# 在本地执行
cd /Users/admin/unity_project/car/deployment/Builds/WebGL

# 上传3个文件
scp index.html virtual-joystick.css virtual-joystick.js root@你的服务器IP:/opt/car-game/deployment/Builds/WebGL/
```

**无需重启服务器**，刷新浏览器即可！

### 方式2：重新上传整个部署包

```bash
# 在本地执行
scp -r /Users/admin/unity_project/car/deployment root@你的服务器IP:/opt/car-game/
```

---

## 🎯 下次重新构建 WebGL 怎么办？

**重要**：Unity 重新构建 WebGL 会覆盖 `index.html`，但**不会**覆盖虚拟摇杆文件！

### 解决方案：使用自动化脚本

在项目根目录有一个 `apply-joystick.sh` 脚本，重新构建后运行它即可：

```bash
# 在 Unity 中重新构建 WebGL 后
cd /Users/admin/unity_project/car
./apply-joystick.sh
```

脚本会自动：
1. ✅ 备份原始 `index.html`
2. ✅ 添加 CSS 引用
3. ✅ 添加 HTML 结构
4. ✅ 添加 JavaScript 引用

---

## 📱 虚拟摇杆特性

### 自动检测
- **移动设备**（手机/平板）：自动显示虚拟摇杆
- **PC 设备**：不显示，使用键盘控制

### 8方向控制
- 上、下、左、右
- 左上、右上、左下、右下

### 视觉设计
- **位置**：左下角，距离边缘 20px
- **大小**：底座 150px，摇杆 60px
- **透明度**：30%-60%，半透明不遮挡游戏
- **方向指示器**：8个小圆点，激活时高亮

### 操作体验
- **触摸反馈**：摇杆跟随手指移动
- **死区**：15px 死区避免误触
- **平滑过渡**：0.1s 过渡动画

---

## 🧪 测试方法

### 手机端测试
1. 用手机浏览器访问：`http://你的服务器IP:8899`
2. 左下角应该显示半透明的虚拟摇杆
3. 拖动摇杆，车辆应该能移动
4. 松开手指，车辆应该停止

### PC端测试
1. 用电脑浏览器访问：`http://你的服务器IP:8899`
2. 不应该显示虚拟摇杆
3. 键盘 WASD/方向键应该正常工作

---

## 🔧 自定义虚拟摇杆

如果你想调整虚拟摇杆的外观或行为，只需编辑这两个文件：

### 调整样式（`virtual-joystick.css`）

```css
/* 调整位置 */
#virtual-joystick {
  bottom: 20px;  /* 距离底部 */
  left: 20px;    /* 距离左侧 */
}

/* 调整大小 */
#joystick-base {
  width: 150px;   /* 底座大小 */
  height: 150px;
}

/* 调整透明度 */
#joystick-base {
  background: rgba(255, 255, 255, 0.3);  /* 0.3 = 30% 不透明度 */
}
```

### 调整行为（`virtual-joystick.js`）

```javascript
// 调整死区大小（第333行）
if (distance > 15) { // 15px 死区，可以改成 20 或 10

// 调整最大移动距离（第318行）
var maxDistance = 45; // 摇杆最大移动距离
```

---

## 📂 文件说明

### `virtual-joystick.css`
- 虚拟摇杆的所有样式
- 包含位置、大小、颜色、透明度等
- **不会被 Unity 构建覆盖**

### `virtual-joystick.js`
- 虚拟摇杆的所有逻辑
- 包含触摸检测、方向计算、键盘模拟等
- **不会被 Unity 构建覆盖**

### `index.html`
- Unity WebGL 的主页面
- 引用了上面两个文件
- **会被 Unity 构建覆盖**（需要重新运行 `apply-joystick.sh`）

---

## ⚠️ 注意事项

1. **虚拟摇杆文件不会被覆盖**
   - `virtual-joystick.css` ✅ 安全
   - `virtual-joystick.js` ✅ 安全

2. **index.html 会被覆盖**
   - 重新构建后运行 `apply-joystick.sh` ✅

3. **浏览器兼容性**
   - iOS Safari ✅
   - Android Chrome ✅
   - 其他现代移动浏览器 ✅

4. **性能影响**
   - 虚拟摇杆不影响游戏性能 ✅
   - 触摸事件响应流畅 ✅

---

## 🎉 完成！

现在你的游戏支持移动端了！

- ✅ PC 端：键盘控制
- ✅ 移动端：虚拟摇杆控制
- ✅ 自动检测设备类型
- ✅ 不会被 Unity 构建覆盖（使用脚本恢复）

---

**更新时间**：2025-11-28
**版本**：v1.1.0 - 移动端虚拟摇杆支持
