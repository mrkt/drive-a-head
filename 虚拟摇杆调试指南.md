# 虚拟摇杆调试指南

## 问题描述
虚拟摇杆在手机端没有显示在屏幕左下角。

## 已添加的调试功能

### 1. 详细的控制台日志
现在虚拟摇杆脚本会输出详细的调试信息，包括：
- 设备检测结果
- 初始化过程
- 元素创建状态
- CSS 样式信息

### 2. 强制显示模式（用于PC测试）
在 URL 后添加 `?joystick=1` 可以在 PC 上强制显示虚拟摇杆：
```
http://localhost:9988?joystick=1
```

## 手机端测试步骤

### 方法1：使用手机浏览器的远程调试

#### iOS Safari
1. 在 iPhone 上：设置 > Safari > 高级 > 开启"网页检查器"
2. 用数据线连接 iPhone 到 Mac
3. 在 Mac 上打开 Safari > 开发 > [你的iPhone] > 选择页面
4. 查看控制台日志

#### Android Chrome
1. 在 Android 手机上：设置 > 开发者选项 > 开启"USB调试"
2. 用数据线连接手机到电脑
3. 在电脑 Chrome 浏览器访问：`chrome://inspect`
4. 找到你的设备和页面，点击"inspect"
5. 查看控制台日志

### 方法2：使用 vConsole（推荐）
在手机上直接查看控制台日志。

## 预期的控制台日志

### 成功初始化时应该看到：
```
Virtual Joystick - Device Detection:
  User Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) ...
  Is Mobile: true
  Has Touch: true
  Force Show (add ?joystick=1 to URL): false
Virtual Joystick - Initializing...
Virtual Joystick - Unity canvas found, creating joystick...
Virtual Joystick - HTML structure inserted
Virtual Joystick - Elements found, setting display...
Virtual Joystick - Display style: block
Virtual Joystick - Position: fixed
Virtual Joystick - Bottom: 30px
Virtual Joystick - Left: 30px
Virtual Joystick - Z-index: 1000
Virtual joystick initialized for mobile
Virtual Joystick - Setup complete! Joystick should be visible at bottom-left corner.
```

### 如果设备检测失败：
```
Virtual Joystick - Device Detection:
  User Agent: ...
  Is Mobile: false
  Has Touch: false
  Force Show (add ?joystick=1 to URL): false
Virtual Joystick - Skipped (not a mobile/touch device)
```

### 如果元素创建失败：
```
Virtual joystick elements not found after insertion!
  joystick: null
  joystickStick: null
  joystickBase: null
```

## 可能的问题和解决方案

### 问题1：设备检测失败
**症状**：看到 "Skipped (not a mobile/touch device)"

**原因**：
- User Agent 不包含移动设备标识
- 浏览器不支持触摸事件

**解决方案**：
- 使用 `?joystick=1` 参数强制显示
- 检查浏览器是否为移动浏览器

### 问题2：Unity Canvas 未加载
**症状**：持续看到 "Waiting for Unity canvas..."

**原因**：
- Unity WebGL 加载失败
- Canvas 元素 ID 不是 "unity-canvas"

**解决方案**：
- 检查 Unity WebGL 是否正常加载
- 检查 index.html 中 canvas 的 ID

### 问题3：CSS 文件未加载
**症状**：摇杆创建成功但不可见

**原因**：
- virtual-joystick.css 文件缺失
- CSS 文件路径错误

**解决方案**：
- 检查 `virtual-joystick.css` 是否存在
- 检查 index.html 中的 CSS 引用路径

### 问题4：Z-index 被覆盖
**症状**：摇杆被其他元素遮挡

**原因**：
- Unity Canvas 的 z-index 更高
- 其他元素覆盖了摇杆

**解决方案**：
- 检查控制台日志中的 z-index 值（应该是 1000）
- 使用浏览器开发者工具检查元素层级

### 问题5：文件缓存问题
**症状**：修改后没有生效

**原因**：
- 浏览器缓存了旧版本文件

**解决方案**：
- 强制刷新：Ctrl+Shift+R (PC) 或 Cmd+Shift+R (Mac)
- 清除浏览器缓存
- 在 URL 后添加版本参数：`?v=2`

## 快速检查清单

- [ ] 确认使用手机浏览器访问（或使用 `?joystick=1`）
- [ ] 确认 `virtual-joystick.css` 文件存在
- [ ] 确认 `virtual-joystick.js` 文件存在
- [ ] 确认 `index.html` 正确引用了这两个文件
- [ ] 清除浏览器缓存并强制刷新
- [ ] 查看控制台日志确认初始化过程
- [ ] 检查是否有 JavaScript 错误

## 文件位置

```
deployment/Builds/WebGL/
├── index.html              # 主页面（引用 CSS 和 JS）
├── virtual-joystick.css    # 摇杆样式
└── virtual-joystick.js     # 摇杆逻辑（已添加调试日志）
```

## 下一步

1. **在手机上访问游戏**
2. **查看控制台日志**（使用远程调试或 vConsole）
3. **根据日志信息判断问题**
4. **参考上面的"可能的问题和解决方案"**

---

**更新时间**：2025-11-28
**版本**：v1.2.1 - 添加调试日志
